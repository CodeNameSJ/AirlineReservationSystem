<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin-layout}" lang="en">
<head>
	<th:block layout:fragment="head">
	</th:block>
	<meta charset="utf-8"/>
	<title th:text="${booking.id != null} ? 'Edit Booking' : 'New Booking'">Booking</title>
</head>
<body>
<div layout:fragment="content">
	<h2 th:text="${booking.id != null} ? 'Edit Booking' : 'New Booking'">Booking</h2>

	<form th:action="@{/admin/bookings/save}" method="post">
		<input type="hidden" name="id" th:value="${booking.id}"/>

		<div class="form-row">
			<label for="user">User</label>
			<select name="userId" id="user" required>
				<option th:each="u : ${users}" th:value="${u.id}"
				        th:text="${u.username + ' (' + (u.email != null ? u.email : 'no-email') + ')'}"
				        th:selected="${booking.user != null && booking.user.id == u.id}">User
				</option>
			</select>
		</div>

		<div class="form-row">
			<label for="flight">Flight</label>
			<select name="flightId" id="flight" required>
				<option th:each="f : ${flights}" th:value="${f.id}"
				        th:text="${f.flightNumber + ' — ' + f.origin + '→' + f.destination + ' @ ' + (f.departureDisplay != null ? f.departureDisplay : '')}"
				        th:selected="${booking.flight != null && booking.flight.id == f.id}">Flight
				</option>
			</select>
		</div>

		<div class="form-row">
			<label for="seats">Seats</label>
			<input type="number" id="seats" name="seats"
			       th:value="${booking.seats == 0 ? 1 : booking.seats}" min="1" required/>
		</div>

		<div class="form-row">
			<label for="seatClass">Seat Class</label>
			<select id="seatClass" name="seatClass" required>
				<option th:each="sc : ${seatClasses}" th:value="${sc}" th:text="${sc}"
				        th:selected="${booking.seatClass != null && booking.seatClass == sc}"></option>
			</select>
		</div>

		<div style="margin-top:12px;">
			<button type="submit">Save</button>
			<a th:href="@{/admin/bookings}">
				<button type="button">Cancel</button>
			</a>
			<form th:if="${booking.id != null}" th:action="@{/admin/bookings/delete}" method="post"
			      style="display:inline;">
				<input type="hidden" name="id" th:value="${booking.id}"/>
				<input type="hidden" name="confirm" value="true"/>
				<button type="submit" style="background:#d9534f;color:white;">Delete</button>
			</form>
		</div>
	</form>
</div>

<div layout:fragment="scripts">
	<script th:src="@{/js/confirmation.js}" defer></script>
</div>
</body>
</html>