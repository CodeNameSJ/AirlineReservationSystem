<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Manage Flights</title>
	<link rel="stylesheet" th:href="@{/css/style.css}"/>
	<style>
		.warning-row {
			background-color: #fff3cd;
		}

		.warning-row td {
			padding: 10px;
		}
	</style>
</head>
<body>
<header>
	<div th:replace="fragments/navbar :: navbar"></div>
</header>
<main>
	<h1>Manage Flights</h1>
	<table style="border:1px solid black; border-collapse: collapse; width:100%;">
		<tr>
			<th>ID</th>
			<th>Flight</th>
			<th>Origin</th>
			<th>Destination</th>
			<th>Departure</th>
			<th>Arrival</th>
			<th>Economy Seats</th>
			<th>Business Seats</th>
			<th>Action</th>
		</tr>

		<tr th:each="flight : ${flights}">
			<!-- Main data row -->
			<td th:text="${flight.id}">1</td>
			<td th:text="${flight.flightNumber}">FL123</td>
			<td th:text="${flight.origin}">OriginCity</td>
			<td th:text="${flight.destination}">DestinationCity</td>
			<td th:text="${flight.departureDisplay != null ? flight.departureDisplay : '-'}">-</td>
			<td th:text="${flight.arrivalDisplay != null ? flight.arrivalDisplay : '-'}">-</td>
			<td th:text="${flight.economySeatsAvailable} + '/' + ${flight.totalEconomySeats}">10/100</td>
			<td th:text="${flight.businessSeatsAvailable} + '/' + ${flight.totalBusinessSeats}">5/20</td>
			<td>
				<!-- Delete triggers the inline confirmation -->
				<form th:method="get" th:action="@{/admin/flights/edit}" style="display:inline;">
					<input type="hidden" name="id" th:value="${flight.id}"/>
					<button type="submit">Edit</button>
					<button type="button" th:onclick="'toggleWarning(' + ${flight.id} + ', true)'">Delete</button>
				</form>
			</td>
		</tr>

		<!-- Inline warning row -->
		<tr th:id="'warning-' + ${flight.id}" class="warning-row" style="display:none;">
			<td colspan="9">
				<strong>&#9888; Are you sure you want to delete this flight? Deleting it will also remove all related bookings.</strong>
				<br/>
				<form th:method="post" th:action="@{/admin/flights/delete}" style="display:inline;">
					<input type="hidden" name="id" th:value="${flight.id}"/>
					<input type="hidden" name="confirm" value="true"/>
					<button type="submit" style="background-color:red; color:white;">Yes, Delete</button>
				</form>
				<button type="button" th:onclick="'toggleWarning(' + ${flight.id} + ', false)'">Cancel</button>
			</td>
		</tr>
	</table>
</main>
<footer>
	<div th:replace="fragments/footer :: footer"></div>
</footer>
<script th:src="@{/js/confirmation.js}" defer></script>
</body>
</html>